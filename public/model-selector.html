<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />
  <title>Model Selector</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0080ff;
      --secondary-color: #1a1a1a;
      --background-color: #121212;
      --panel-color: rgba(30, 30, 30, 0.95);
      --border-color: #333;
      --text-color: #f0f0f0;
      --success-color: #4CAF50;
      --warning-color: #FF9800;
      --error-color: #F44336;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }

    h1 {
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 600;
      text-align: center;
    }

    .model-selector-container {
      width: 100%;
      max-width: 550px;
      background-color: var(--panel-color);
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
    }

    .section {
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .provider-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }

    .provider-button {
      padding: 8px 16px;
      background-color: var(--secondary-color);
      border: 2px solid var(--secondary-color);
      border-radius: 6px;
      color: var(--text-color);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .provider-button.selected {
      border-color: var(--primary-color);
      background-color: rgba(0, 128, 255, 0.15);
    }

    .model-section {
      margin-top: 16px;
    }

    select, input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      background-color: var(--secondary-color);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-color);
      font-family: 'Inter', sans-serif;
    }

    .button-row {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      border: none;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button.btn-cancel {
      background-color: transparent;
      border: 1px solid var(--border-color);
    }

    button:hover {
      background-color: #0066cc;
    }

    button.btn-cancel:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    button.disabled {
      background-color: #808080;
      cursor: not-allowed;
    }

    .status {
      margin-top: 16px;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
    }

    .status.success {
      background-color: rgba(76, 175, 80, 0.2);
      color: var(--success-color);
    }

    .status.warning {
      background-color: rgba(255, 152, 0, 0.2);
      color: var(--warning-color);
    }

    .status.error {
      background-color: rgba(244, 67, 54, 0.2);
      color: var(--error-color);
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="model-selector-container">
    <h1>Select AI Model1111</h1>
    
    <div class="section">
      <div class="section-title">AI Provider</div>
      <div class="provider-buttons">
        <button class="provider-button selected" data-provider="openai">OpenAI</button>
        <button class="provider-button" data-provider="ollama">Ollama</button>
        <button class="provider-button" data-provider="gemini">Gemini</button>
      </div>
    </div>
    
    <!-- OpenAI section -->
    <div id="openai-section" class="section model-section">
      <div class="section-title">OpenAI Model</div>
      <select id="openai-model">
        <option value="gpt-4o-mini">GPT-4o Mini (Fastest)</option>
        <option value="gpt-4o">GPT-4o (Most capable)</option>
        <option value="gpt-4-vision-preview">GPT-4 Vision</option>
        <option value="gpt-4-turbo">GPT-4 Turbo</option>
      </select>
    </div>
    
    <!-- Ollama section -->
    <div id="ollama-section" class="section model-section hidden">
      <div class="section-title">Ollama Settings</div>
      <input type="text" id="ollama-url" placeholder="Ollama URL (e.g. http://127.0.0.1:11434)" value="http://127.0.0.1:11434">
      <select id="ollama-model">
        <option value="deepseek-r1:14b">deepseek-r1:14b (Recommended)</option>
        <option value="llava:7b">llava:7b</option>
        <option value="llava:13b">llava:13b</option>
        <option value="llama3:8b">llama3:8b</option>
      </select>
    </div>
    
    <!-- Gemini section -->
    <div id="gemini-section" class="section model-section hidden">
      <div class="section-title">Gemini Model</div>
      <select id="gemini-model">
        <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
        <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
      </select>
    </div>
    
    <div class="button-row">
      <button id="save-btn" class="btn-save">Save Settings</button>
      <button id="cancel-btn" class="btn-cancel">Cancel</button>
    </div>
    
    <div id="status-message" class="status hidden"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Elements
      const providerButtons = document.querySelectorAll('.provider-button');
      const openaiSection = document.getElementById('openai-section');
      const ollamaSection = document.getElementById('ollama-section');
      const geminiSection = document.getElementById('gemini-section');
      const openaiModelSelect = document.getElementById('openai-model');
      const ollamaUrlInput = document.getElementById('ollama-url');
      const ollamaModelSelect = document.getElementById('ollama-model');
      const geminiModelSelect = document.getElementById('gemini-model');
      const saveButton = document.getElementById('save-btn');
      const cancelButton = document.getElementById('cancel-btn');
      const statusMessage = document.getElementById('status-message');
      
      // Current settings
      let currentSettings = {
        aiProvider: 'openai',
        currentModel: 'gpt-4o-mini',
        ollamaUrl: 'http://127.0.0.1:11434'
      };
      
      // Load current settings
      try {
        const settings = await window.electron.ipcRenderer.invoke('get-current-settings');
        if (settings) {
          currentSettings = { ...currentSettings, ...settings };
          
          // Update UI with current settings
          updateUIFromSettings();
        }
      } catch (error) {
        console.error('Error loading settings:', error);
        showStatus('Could not load current settings, using defaults', 'warning');
      }
      
      // Show initial UI based on current settings
      function updateUIFromSettings() {
        // Select the right provider button
        providerButtons.forEach(btn => {
          btn.classList.toggle('selected', btn.dataset.provider === currentSettings.aiProvider);
        });
        
        // Show the right model section
        openaiSection.classList.toggle('hidden', currentSettings.aiProvider !== 'openai');
        ollamaSection.classList.toggle('hidden', currentSettings.aiProvider !== 'ollama');
        geminiSection.classList.toggle('hidden', currentSettings.aiProvider !== 'gemini');
        
        // Set the right model
        if (currentSettings.aiProvider === 'openai') {
          openaiModelSelect.value = currentSettings.currentModel;
        } else if (currentSettings.aiProvider === 'ollama') {
          ollamaModelSelect.value = currentSettings.currentModel;
          ollamaUrlInput.value = currentSettings.ollamaUrl || 'http://127.0.0.1:11434';
        } else if (currentSettings.aiProvider === 'gemini') {
          geminiModelSelect.value = currentSettings.currentModel;
        }
      }
      
      // Provider button click handler
      providerButtons.forEach(button => {
        button.addEventListener('click', () => {
          const provider = button.dataset.provider;
          
          // Update selected button
          providerButtons.forEach(btn => {
            btn.classList.toggle('selected', btn === button);
          });
          
          // Show appropriate section
          openaiSection.classList.toggle('hidden', provider !== 'openai');
          ollamaSection.classList.toggle('hidden', provider !== 'ollama');
          geminiSection.classList.toggle('hidden', provider !== 'gemini');
          
          // Update settings
          currentSettings.aiProvider = provider;
          
          // Set default model for the provider
          if (provider === 'openai') {
            currentSettings.currentModel = openaiModelSelect.value;
          } else if (provider === 'ollama') {
            currentSettings.currentModel = ollamaModelSelect.value;
          } else if (provider === 'gemini') {
            currentSettings.currentModel = geminiModelSelect.value;
          }
        });
      });
      
      // Model select change handlers
      openaiModelSelect.addEventListener('change', () => {
        if (currentSettings.aiProvider === 'openai') {
          currentSettings.currentModel = openaiModelSelect.value;
        }
      });
      
      ollamaModelSelect.addEventListener('change', () => {
        if (currentSettings.aiProvider === 'ollama') {
          currentSettings.currentModel = ollamaModelSelect.value;
        }
      });
      
      geminiModelSelect.addEventListener('change', () => {
        if (currentSettings.aiProvider === 'gemini') {
          currentSettings.currentModel = geminiModelSelect.value;
        }
      });
      
      // Ollama URL change handler
      ollamaUrlInput.addEventListener('change', () => {
        currentSettings.ollamaUrl = ollamaUrlInput.value;
      });
      
      // Save button click handler
      saveButton.addEventListener('click', async () => {
        saveButton.textContent = 'Saving...';
        saveButton.disabled = true;
        
        try {
          // Update model based on current provider
          if (currentSettings.aiProvider === 'openai') {
            currentSettings.currentModel = openaiModelSelect.value;
          } else if (currentSettings.aiProvider === 'ollama') {
            currentSettings.currentModel = ollamaModelSelect.value;
            currentSettings.ollamaUrl = ollamaUrlInput.value.replace('localhost', '127.0.0.1');
          } else if (currentSettings.aiProvider === 'gemini') {
            currentSettings.currentModel = geminiModelSelect.value;
          }
          
          // Test Ollama connection if using Ollama
          if (currentSettings.aiProvider === 'ollama') {
            showStatus('Testing Ollama connection...', 'warning');
            
            try {
              const ollamaUrl = currentSettings.ollamaUrl || 'http://127.0.0.1:11434';
              const response = await fetch(`${ollamaUrl}/api/version`);
              
              if (!response.ok) {
                showStatus(`Could not connect to Ollama at ${ollamaUrl}. Check if Ollama is running.`, 'error');
                saveButton.textContent = 'Save Settings';
                saveButton.disabled = false;
                return;
              }
            } catch (error) {
              showStatus(`Connection to Ollama failed: ${error.message}`, 'error');
              saveButton.textContent = 'Save Settings';
              saveButton.disabled = false;
              return;
            }
          }
          
          // Save settings via IPC
          window.electron.ipcRenderer.send('update-model-settings', currentSettings);
          showStatus('Settings saved successfully!', 'success');
          
          // Close window after a delay
          setTimeout(() => {
            window.close();
          }, 1000);
        } catch (error) {
          console.error('Error saving settings:', error);
          showStatus(`Error saving settings: ${error.message}`, 'error');
          saveButton.textContent = 'Save Settings';
          saveButton.disabled = false;
        }
      });
      
      // Cancel button click handler
      cancelButton.addEventListener('click', () => {
        window.close();
      });
      
      // Show status message
      function showStatus(message, type = 'success') {
        statusMessage.textContent = message;
        statusMessage.className = `status ${type}`;
        
        // Clear status message after a timeout for success messages
        if (type === 'success') {
          setTimeout(() => {
            statusMessage.classList.add('hidden');
          }, 3000);
        }
      }
      
      // Close on ESC key
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          window.close();
        }
      });
    });
  </script>
</body>
</html> 